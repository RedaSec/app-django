version: "3.8"


services:
  web:
    build: .
    container_name: my_django_app
    command: bash -c "python manage.py migrate && python manage.py runserver 0.0.0.0:8000"
    restart: always
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=proxy"
      - "traefik.http.routers.api.rule=Host(`farsi.gizmoyab.com`)"
      - "traefik.http.services.api.loadbalancer.server.port=8000"
      - "traefik.http.routers.api.entrypoints=web"
    environment:
      - DJANGO_DEBUG=TRUE
      - DJANGO_SECURE_SSL_REDIRECT=TRUE
      - DJANGO_SECURE_HSTS_INCLUDE_SUBDOMAINS=TRUE
      - DJANGO_SECURE_HSTS_PRELOAD=TRUE
      - DJANGO_SECURE_HSTS_SECONDS=31536000
      - DJANGO_SESSION_COOKIE_SECURE=TRUE
      - DJANGO_CSRF_COOKIE_SECURE=TRUE
      - DJANGO_SECRET_KEY=vy5yralfkenfjkensqweoi82345snf4wzbfx
      - DJANGO_HOST_NAME=myhostname
    # depends_on:
    #   - db
    # volumes:
    #   - .:/django_app
    ports:
      - "8001:8000"
    networks:
      - proxy

#   db:
#     image: mysql:8
#     volumes:
#       - mysql_data:/var/lib/mysql
#     environment:
#       - MYSQL_ROOT_PASSWORD=rootpass123
#       - MYSQL_DATABASE=mysql-db
#       - MYSQL_USER=mysqluser
#       - MYSQL_PASSWORD=testpass123
#       - MYSQL_TCP_PORT=3306
#     networks:
#       - proxy


# volumes:
#   mysql_data:

networks:
  proxy:
    external: true


